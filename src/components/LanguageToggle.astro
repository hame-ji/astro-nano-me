---
import { getRelativeLocaleUrl } from "astro:i18n";

const lang = Astro.locals.lang;
const base = import.meta.env.BASE_URL;
const pathname = Astro.url.pathname;
const pathWithoutBase = base !== "/" ? pathname.replace(base, "") : pathname;
const stripped = pathWithoutBase.replace(/^\/(en|fr)(?=\/|$)/, "");
const currentPath = stripped.replace(/\/$/, "") || "/";

const getAlternateUrl = (targetLang: string) => {
  return getRelativeLocaleUrl(
    targetLang,
    currentPath === "/" ? "/" : currentPath
  );
};
---

<div
  class="flex items-center gap-1.5 rounded-full border border-black/10 bg-white/70 px-1.5 py-0.5 text-[10px] uppercase tracking-wide text-black/70 backdrop-blur dark:border-white/15 dark:bg-black/40 dark:text-white/70"
>
  <a
    href={getAlternateUrl("en")}
    class:list={[
      "flex items-center gap-1 rounded-full px-1.5 py-0.5 transition-colors",
      lang === "en"
        ? "bg-black/10 text-black dark:bg-white/20 dark:text-white"
        : "hover:bg-black/5 hover:text-black dark:hover:bg-white/10 dark:hover:text-white",
    ]}
    aria-label="Switch to English"
  >
    <span class="text-xs">ðŸ«–</span>
    <span>EN</span>
  </a>
  <div class="h-3 w-px bg-black/10 dark:bg-white/15"></div>
  <a
    href={getAlternateUrl("fr")}
    class:list={[
      "flex items-center gap-1 rounded-full px-1.5 py-0.5 transition-colors",
      lang === "fr"
        ? "bg-black/10 text-black dark:bg-white/20 dark:text-white"
        : "hover:bg-black/5 hover:text-black dark:hover:bg-white/10 dark:hover:text-white",
    ]}
    aria-label="Passer en franÃ§ais"
  >
    <span class="text-xs">ðŸ¥–</span>
    <span>FR</span>
  </a>
</div>
