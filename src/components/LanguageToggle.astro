---
import { getRelativeLocaleUrl } from "astro:i18n";
import { ensureLeadingSlash } from "@lib/utils";

const lang = Astro.locals.lang;
const base = import.meta.env.BASE_URL;
const pathname = Astro.url.pathname;
const pathWithoutBase = base !== "/" ? pathname.replace(base, "") : pathname;
const stripped = pathWithoutBase.replace(/^\/(en|fr)(?=\/|$)/, "");
const currentPath = stripped.replace(/\/$/, "") || "/";
const normalizedPath = currentPath === "/" ? "" : currentPath;

const getAlternateUrl = (targetLang: string) => {
  return ensureLeadingSlash(getRelativeLocaleUrl(targetLang, normalizedPath));
};
---

<div class="flex items-center gap-1 text-sm">
  <a
    href={getAlternateUrl("en")}
    class:list={[
      "flex items-center gap-0.5 transition-colors",
      lang === "en"
        ? "text-black dark:text-white"
        : "text-black/50 hover:text-black dark:text-white/50 dark:hover:text-white",
    ]}
    aria-label="Switch to English"
  >
    <span>ðŸ«–</span>
    <span>EN</span>
  </a>
  <span class="text-black/30 dark:text-white/30">/</span>
  <a
    href={getAlternateUrl("fr")}
    class:list={[
      "flex items-center gap-0.5 transition-colors",
      lang === "fr"
        ? "text-black dark:text-white"
        : "text-black/50 hover:text-black dark:text-white/50 dark:hover:text-white",
    ]}
    aria-label="Passer en franÃ§ais"
  >
    <span>ðŸ¥–</span>
    <span>FR</span>
  </a>
</div>
